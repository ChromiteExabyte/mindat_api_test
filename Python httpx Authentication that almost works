import httpx
import asyncio

def api_token_auth_create(username, password):
    # Define the payload
    payload = {
        "username": username,
        "password": password
    }

    # Define the base URL of the API
    base_url = "https://api.mindat.org/"

    # Define the endpoint URL
    endpoint_url = "https://api.mindat.org/api-token-auth/"

    # Make a POST request to authenticate and obtain the API token
    response = httpx.post(endpoint_url, json=payload)

    # Check if the request was successful
    if response.status_code == 200:
        # Extract the API token from the response
        token = response.json().get("token")
        return token
    else:
        # Handle authentication failure
        print("Authentication failed")
        return None

async def main():
    # Input API key
    api_key = input("Please enter your Mindat API key: ")

    # Set the API key as a header
    headers = {'Authorization': 'Token ' + api_key}

    # Input username and password
    username = input("Please enter your username: ")
    password = input("Please enter your password: ")

    # Call the authentication function
    token = api_token_auth_create(username, password)

    if token:
        
        # :)
        print("Nice, it works!")
        
    else:
        # :(
        print("It doesn't work, oof.")

# Run the main function
asyncio.run(main())
